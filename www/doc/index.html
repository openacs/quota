
Important:
----------

At this stage, quota only works with web uploads. Not webdav.

Besides to install the package quota, to make work it you must modify the file file-storage/www/file-add.tcl
of a form similar to this:


CHANGE THIS
max_size -requires {upload_file} {
    set n_bytes [file size ${upload_file.tmpfile}]
    set max_bytes [ad_parameter "MaximumFileSize"]
    if { $n_bytes > $max_bytes } {
        ad_complain "Your file is larger than the maximum file size allowed on this system ([util_commify_number $max_bytes] bytes)"
    }
}   

FOR
max_size -requires {upload_file} {
    set n_bytes [file size ${upload_file.tmpfile}]
    set max_bytes [ad_parameter "MaximumFileSize"]
    if { $n_bytes > $max_bytes } {
        ad_complain "Your file is larger than the maximum file size allowed on this system ([util_commify_number $max_bytes] bytes)"
    }

    #***************************************
    set u_id [ad_conn user_id]
    set c_id [dotlrn_community::get_community_id]
    set kb_size [expr $n_bytes / 1024]
    set quota_ctrl [quota::check_quota -community_id $c_id -user_id $u_id -filesize $kb_size]
    if {!$quota_ctrl} {
      ad_complain "The size of the file execedes the quota that you have assigned or the quota of the group/community"
    }
    #***************************************
}

